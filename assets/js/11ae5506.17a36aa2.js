"use strict";(self.webpackChunkdeepstream_io_website=self.webpackChunkdeepstream_io_website||[]).push([[6364],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=a,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||i;return n?r.createElement(m,o(o({ref:t},u),{},{components:n})):r.createElement(m,o({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6639:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return u},default:function(){return d}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],s={title:"Security Overview"},l=void 0,c={unversionedId:"tutorials/concepts/security",id:"tutorials/concepts/security",title:"Security Overview",description:"Security in deepstream is based on three interrelated concepts:",source:"@site/docs/00-tutorials/00-concepts/30-security.md",sourceDirName:"00-tutorials/00-concepts",slug:"/tutorials/concepts/security",permalink:"/docs/tutorials/concepts/security",editUrl:"https://github.com/deepstreamIO/deepstream.io-website/docs/00-tutorials/00-concepts/30-security.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{title:"Security Overview"},sidebar:"tutorialSidebar",previous:{title:"Connectivity",permalink:"/docs/tutorials/concepts/connectivity"},next:{title:"Modelling relational data",permalink:"/docs/tutorials/concepts/modelling-relational-data"}},u=[{value:"Encrypted Connections",id:"encrypted-connections",children:[],level:2},{value:"Authentication",id:"authentication",children:[{value:"Authentication FAQ",id:"authentication-faq",children:[],level:3}],level:2},{value:"Permissioning",id:"permissioning",children:[],level:2}],p={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Security in deepstream is based on three interrelated concepts:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"encrypted connections"),(0,i.kt)("li",{parentName:"ul"},"user authentication"),(0,i.kt)("li",{parentName:"ul"},"granular permissions")),(0,i.kt)("p",null,"Here's how they work together:"),(0,i.kt)("h2",{id:"encrypted-connections"},"Encrypted Connections"),(0,i.kt)("p",null,"deepstream supports transport layer security for web-facing connections using HTTPS and WSS. To setup SSL on deepstream, you need to provide the following configuration keys:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"ssl:\n  key: fileLoad(./my-key.key)\n  cert: fileLoad(./my-key.key)\n")),(0,i.kt)("p",null,"It's highly recommended to always use a seperate process to do SSL termination. Usually via a load balancer (e.g. Nginx or HA Proxy). To learn more about this, head over to the ",(0,i.kt)("a",{parentName:"p",href:"../devops/nginx"},"Nginx Tutorial"),"."),(0,i.kt)("h2",{id:"authentication"},"Authentication"),(0,i.kt)("p",null,"Every incoming connection needs to pass an authentication step. This happens when the client calls ",(0,i.kt)("inlineCode",{parentName:"p"},"login(data, callback)"),".\ndeepstream comes with three built-in authentication mechanisms:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/core/auth/none"},"none")," allows every connection. Choose this option for public sites that don't require access controls."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/core/auth/file"},"file")," reads authentication data from a static file. This is a good choice for public read / private write use cases, e.g. sports result pages that let every user visit, but only a few backend processes update the result."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/core/auth/storage"},"storage")," authentication allows you to store usernames, password hashes and optional meta-data in a table within your database that will be used to authenticate incoming connections."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/core/auth/http-webhook"},"http")," contacts a configurable HTTP webhook to ask if a user is allowed to connect. This is the most flexible option as it allows you to write a tiny http server in any language that can connect to databases, active directories, oAuth providers or whatever else your heart desires. http auth can be combined with ",(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/core/auth/jwt-auth/"},"jwt"),".")),(0,i.kt)("p",null,"Apart from just accepting / denying incoming connections, the authentication step can also provide two extra bits of information:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"clientData")," is returned to the client upon login. This is useful to provide user specific settings upon login, e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},'{ "view": "author" }')," for a blog"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"serverData")," is kept privately on the server and passed to the permission handler whenever a client performs an action. This makes certain security concepts possible, e.g. role based authentication.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'"system-settings": {\n    //publicly readable\n    "read": true,\n    //writable only by admin\n    "write": "user.data.role === \'admin\'"\n}\n')),(0,i.kt)("h3",{id:"authentication-faq"},"Authentication FAQ"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"When exactly does authentication happen?")," When a deepstream client is created, it establishes a connection straight away. The connection however remains in a quarantine state until ",(0,i.kt)("inlineCode",{parentName:"li"},"login()")," is called. This makes sure that auth-data is sent over an encrypted connection and helps to get the at times time-consuming connection establishment out of the way while the user is busy typing passwords."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Can I read usernames for auth purposes out of a deepstream record?"),"\nThere's no built-in support for this at the moment, but it's easy to use the http auth-type and write a server that reads from the same database or cache deepstream connects to."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Can a user connect more than once at the same time"),"\nYes. The same user can connect multiple times from separate browser windows or devices.")),(0,i.kt)("h2",{id:"permissioning"},"Permissioning"),(0,i.kt)("p",null,"Permissioning is the act of deciding whether a specific action, e.g. writing to a record or subscribing to an event is allowed.\nTo help with this, deepstream uses an expressive, JSON-based permissioning\nlanguage called Valve. There's a lot to say about Valve. Here's a small Valve\nFile that should give you a first impression, to learn more though head over to\nthe ",(0,i.kt)("a",{parentName:"p",href:"/docs/tutorials/core/permission/valve-introduction/"},"permissioning tutorial")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'record:\n\n  "*":\n    create: true\n    delete: true\n    write: true\n    read: true\n    listen: true\n\n  public-read-private-write/$userid:\n    read: true\n    create: "user.id === $userid"\n    write: "user.id === $userid"\n\n  only-increment:\n    write: "!oldData.value || data.value > oldData.value"\n    create: true\n    read: true\n\n  only-delete-egon-miller/$firstname/$lastname:\n    delete: "$firstname.toLowerCase() === \'egon\' && $lastname.toLowerCase() === \'miller\'"\n\n  only-allows-purchase-of-products-in-stock/$purchaseId:\n    create: true\n    write: "_(\'item/\' + data.itemId ).stock > 0"\n\nevent:\n\n  "*":\n    listen: true\n    publish: true\n    subscribe: true\n\n  open/"*":\n    listen: true\n    publish: true\n    subscribe: true\n\n  forbidden/"*":\n    publish: false\n    subscribe: false\n\n  a-to-b/"*":\n    publish: "user.id === \'client-a\'"\n    subscribe: "user.id === \'client-b\'"\n\n  news/$topic:\n    publish: "$topic === \'tea-cup-pigs\'"\n\n  number:\n    publish: "typeof data === \'number\' && data > 10"\n\n  place/$city:\n    publish: "$city.toLowerCase() === data.address.city.toLowerCase()"\n\nrpc:\n\n  "*":\n    provide: true\n    request: true\n\n  a-provide-b-request:\n    provide: "user.id === \'client-a\'"\n    request: "user.id === \'client-b\'"\n\n  only-full-user-data:\n    request: "typeof data.firstname === \'string\' && typeof data.lastname === \'string\'"\n')))}d.isMDXComponent=!0}}]);