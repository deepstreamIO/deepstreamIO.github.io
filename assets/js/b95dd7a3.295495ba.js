"use strict";(self.webpackChunkdeepstreamio_github_io=self.webpackChunkdeepstreamio_github_io||[]).push([[8036],{2484:(e,r,t)=>{t.r(r),t.d(r,{contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var n=t(8168),o=(t(6540),t(5680));const i={title:"Vertical Cluster Connector"},s=void 0,a={unversionedId:"tutorials/plugins/clusternode/vertical",id:"tutorials/plugins/clusternode/vertical",title:"Vertical Cluster Connector",description:"How to use vertical clustering with deepstream?",source:"@site/docs/00-tutorials/60-plugins/50-clusternode/vertical.md",sourceDirName:"00-tutorials/60-plugins/50-clusternode",slug:"/tutorials/plugins/clusternode/vertical",permalink:"/docs/tutorials/plugins/clusternode/vertical",editUrl:"https://github.com/deepstreamIO/deepstreamIO.github.io/docs/00-tutorials/60-plugins/50-clusternode/vertical.md",tags:[],version:"current",frontMatter:{title:"Vertical Cluster Connector"},sidebar:"tutorialSidebar",previous:{title:"Redis Cluster Connector",permalink:"/docs/tutorials/plugins/clusternode/redis"},next:{title:"Deepstream Monitoring",permalink:"/docs/tutorials/plugins/monitoring/monitoring"}},l=[{value:"How to use vertical clustering with deepstream?",id:"how-to-use-vertical-clustering-with-deepstream",children:[],level:4}],c={toc:l},u="wrapper";function p(e){let{components:r,...t}=e;return(0,o.yg)(u,(0,n.A)({},c,t,{components:r,mdxType:"MDXLayout"}),(0,o.yg)("h4",{id:"how-to-use-vertical-clustering-with-deepstream"},"How to use vertical clustering with deepstream?"),(0,o.yg)("p",null,"Starting with version 6.1 deepstream comes with the vertical cluster plugin that can be enabled via the config option. It's responsible for allowing deepstream nodes to communicate with each other while running on different cores in the same machine. This way, all the machine cores can be used to run a deepstream cluster: no network latency!"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"clusterNode:\n  name: vertical\n")),(0,o.yg)("p",null,"In order to run multiple deepstream servers on each core you can use the following example code:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const cluster = require('cluster')\nconst numCPUs = require('os').cpus().length\nconst process = require('process')\nconst { Deepstream } = require('@deepstream/server')\nconst server = new Deepstream({\n  clusterNode: { name: 'vertical' }\n})\n\nif (cluster.isPrimary) {\n  console.log(`Primary ${process.pid} is running`)\n\n  // Fork workers.\n  for (let i = 0; i < numCPUs; i++) {\n    cluster.fork()\n  }\n\n  cluster.on('exit', (worker, code, signal) => {\n    console.log(`worker ${worker.process.pid} died`)\n  })\n} else {\n  // Workers can share any TCP connection\n  // In this case it is an HTTP server\n\n  server.start()\n  console.log(`Worker ${process.pid} started`)\n}\n")),(0,o.yg)("p",null,"Or just use the deepstream CLI command ",(0,o.yg)("a",{parentName:"p",href:"/docs/docs/server/command-line-interface#deepstream-cluster"},(0,o.yg)("inlineCode",{parentName:"a"},"./deepstream cluster"))))}p.isMDXComponent=!0},5680:(e,r,t)=>{t.d(r,{xA:()=>u,yg:()=>g});var n=t(6540);function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){o(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function a(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=n.createContext({}),c=function(e){var r=n.useContext(l),t=r;return e&&(t="function"==typeof e?e(r):s(s({},r),e)),t},u=function(e){var r=c(e.components);return n.createElement(l.Provider,{value:r},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},m=n.forwardRef((function(e,r){var t=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),p=c(t),m=o,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||i;return t?n.createElement(g,s(s({ref:r},u),{},{components:t})):n.createElement(g,s({ref:r},u))}));function g(e,r){var t=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var i=t.length,s=new Array(i);s[0]=m;var a={};for(var l in r)hasOwnProperty.call(r,l)&&(a[l]=r[l]);a.originalType=e,a[p]="string"==typeof e?e:o,s[1]=a;for(var c=2;c<i;c++)s[c]=t[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);