"use strict";(self.webpackChunkdeepstreamio_github_io=self.webpackChunkdeepstreamio_github_io||[]).push([[905],{3905:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return m}});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(r),m=i,h=d["".concat(l,".").concat(m)]||d[m]||c[m]||a;return r?n.createElement(h,s(s({ref:t},u),{},{components:r})):n.createElement(h,s({ref:t},u))}));function m(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,s=new Array(a);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var p=2;p<a;p++)s[p]=r[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},245:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var n=r(7462),i=r(3366),a=(r(7294),r(3905)),s=["components"],o={title:"Valve Simple",description:"Learn the basics of Valve and permissions in deepstream"},l=void 0,p={unversionedId:"tutorials/core/permission/valve-simple",id:"tutorials/core/permission/valve-simple",title:"Valve Simple",description:"Learn the basics of Valve and permissions in deepstream",source:"@site/docs/00-tutorials/20-core/30-permission/20-valve-simple.md",sourceDirName:"00-tutorials/20-core/30-permission",slug:"/tutorials/core/permission/valve-simple",permalink:"/docs/tutorials/core/permission/valve-simple",editUrl:"https://github.com/deepstreamIO/deepstreamIO.github.io/docs/00-tutorials/20-core/30-permission/20-valve-simple.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{title:"Valve Simple",description:"Learn the basics of Valve and permissions in deepstream"},sidebar:"tutorialSidebar",previous:{title:"Valve Introduction",permalink:"/docs/tutorials/core/permission/valve-introduction"},next:{title:"Valve Advanced",permalink:"/docs/tutorials/core/permission/valve-advanced"}},u=[{value:"What can be permissioned?",id:"what-can-be-permissioned",children:[],level:2},{value:"How do permissions work?",id:"how-do-permissions-work",children:[],level:2},{value:"How to use Valve rules?",id:"how-to-use-valve-rules",children:[],level:2},{value:"Let&#39;s start with a simple example",id:"lets-start-with-a-simple-example",children:[],level:2},{value:"What&#39;s next?",id:"whats-next",children:[],level:2}],c={toc:u};function d(e){var t=e.components,r=(0,i.Z)(e,s);return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Permissions give you granular control over which records, events or RPCs can be used in which way by which user."),(0,a.kt)("h2",{id:"what-can-be-permissioned"},"What can be permissioned?"),(0,a.kt)("p",null,"Permissions allow you to specify if a user can create, write, read or delete a record, publish or subscribe to events, provide and make RPCs or listen to other client's subscriptions."),(0,a.kt)("h2",{id:"how-do-permissions-work"},"How do permissions work?"),(0,a.kt)("p",null,'deepstream uses a permission syntax called "Valve". Valve rules are simple javascript strings with a reduced feature-set. Each valve rule defines access to a specific action related to a specific concept, e.g. a "write" to a "record".'),(0,a.kt)("p",null,"Here's what they look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'record:\n    # an auctioned item\n    auction/item/$sellerId/$itemId:\n        # everyone can see the item and its price\n        read: true\n\n        # only users with canBid flag in their authData can bid\n        # and bids can only be higher than the current price\n        write: "user.data.canBid && data.price > oldData.price"\n\n        # only the seller can delete the item\n        delete: "user.id == $sellerId"\n')),(0,a.kt)("h2",{id:"how-to-use-valve-rules"},"How to use Valve rules?"),(0,a.kt)("p",null,"Valve rules can be written in YAML or JSON in the ",(0,a.kt)("inlineCode",{parentName:"p"},"permissions")," file (path in ",(0,a.kt)("inlineCode",{parentName:"p"},"permissions/options/path")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"config.yml"),")."),(0,a.kt)("p",null,"The file has three levels of nesting:\nType (record, event or rpc)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"- Name (record, event or rpc name)\n    - Action( read, write, delete, publish etc.)\n")),(0,a.kt)("h2",{id:"lets-start-with-a-simple-example"},"Let's start with a simple example"),(0,a.kt)("p",null,"Let's say we're building a notification system that allows users to send their status as event (a mini Twitter if you like). Every user can subscribe to another user's status, but users can only publish their own status updates."),(0,a.kt)("p",null,"First, let's define default actions for all events. Our example platform is open, so generally everyone can publish and subscribe. Listening is not part of the platform, so let's just turn it off altogether:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'event:\n    "*":\n        publish: true\n        subscribe: true\n        listen: false\n')),(0,a.kt)("p",null,"Next, let's define rules for our status events. Our event names will follow the schema ",(0,a.kt)("inlineCode",{parentName:"p"},"user-status/<username>"),", e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"user-status/lisa"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'event:\n    "*":\n        publish: true\n        subscribe: true\n        listen: false\n    user-status/$userId:\n        publish: "user.id === $userId" #users can only share their own status\n')),(0,a.kt)("p",null,"This example introduced two basic concepts:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"specificity")," Valve uses a simple specificity concept to find out which rule to apply: The longest (e.g. most detailed) rule wins. ",(0,a.kt)("inlineCode",{parentName:"p"},"user-status/$userId")," is longer than the general rule ",(0,a.kt)("inlineCode",{parentName:"p"},'"*"'),", so for publish operations it will be applied. For subscribe and listen though, the permission will fall back to the general rule ",(0,a.kt)("inlineCode",{parentName:"p"},'"*"'),".")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"path variables")," dollar prefixes identify parts of a record, RPC or eventname as variables, e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"$userId")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"user-status/$userId"),". These variables will be made available within the permission rule. Using e.g. the username as part of the record name for records with access restrictions is a central concept in valve."))),(0,a.kt)("h2",{id:"whats-next"},"What's next?"),(0,a.kt)("p",null,"This was a quick introduction to what valve can do, but there are more powerful concepts, such as build-in variables, string-functions or cross-references to explore. To learn about these, let's move on to the ",(0,a.kt)("a",{parentName:"p",href:"/docs/tutorials/core/permission/valve-advanced/"},"advanced permission tutorial")))}d.isMDXComponent=!0}}]);