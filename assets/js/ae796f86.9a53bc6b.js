"use strict";(self.webpackChunkdeepstream_io_website=self.webpackChunkdeepstream_io_website||[]).push([[28],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,c=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),m=l(n),d=s,v=m["".concat(c,".").concat(d)]||m[d]||u[d]||o;return n?r.createElement(v,i(i({ref:t},p),{},{components:n})):r.createElement(v,i({ref:t},p))}));function d(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,i=new Array(o);i[0]=m;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a.mdxType="string"==typeof e?e:s,i[1]=a;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5048:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return a},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return m}});var r=n(7462),s=n(3366),o=(n(7294),n(3905)),i=["components"],a={title:"Emitting events",description:"Step three: Emitting events as the post progresses"},c=void 0,l={unversionedId:"guides/live-progress-bar/server-events",id:"guides/live-progress-bar/server-events",title:"Emitting events",description:"Step three: Emitting events as the post progresses",source:"@site/docs/20-guides/live-progress-bar/30-server-events.md",sourceDirName:"20-guides/live-progress-bar",slug:"/guides/live-progress-bar/server-events",permalink:"/docs/guides/live-progress-bar/server-events",editUrl:"https://github.com/deepstreamIO/deepstream.io-website/docs/20-guides/live-progress-bar/30-server-events.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{title:"Emitting events",description:"Step three: Emitting events as the post progresses"},sidebar:"tutorialSidebar",previous:{title:"Logging in to deepstream",permalink:"/docs/guides/live-progress-bar/login"},next:{title:"Visualizing in the frontend",permalink:"/docs/guides/live-progress-bar/visualizing-in-the-frontend"}},p=[{value:"Events",id:"events",children:[],level:3},{value:"Express Post Route",id:"express-post-route",children:[],level:3}],u={toc:p};function m(e){var t=e.components,n=(0,s.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"With deepstream setup and an open connection, it's time to simulate a POST handler that takes a long time and send out realtime events for each of the completed stages."),(0,o.kt)("p",null,"Events in deepstream is very similar to the normal JS event emitter. You can emit, subscribe, unsubscribe and do some extra magic we'll skip for now!"),(0,o.kt)("h3",{id:"events"},"Events"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function eventHandler (...args) {\n  console.log('event received with data', ...args)\n}\n\n// Subscribe to an event across the deepstream cluster\nclient.event.subscribe('event-name', eventHandler)\n\n// Emit an event out to the deepstream cluster (and locally)\nclient.event.emit('event-name', { timestamp: Date.now() })\n\n// Unsubscribe to the event across the deepstream cluster\nclient.event.unsubscribe('event-name', eventHandler)\n")),(0,o.kt)("h3",{id:"express-post-route"},"Express Post Route"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// A small util function to make code easier to read\nconst PromiseDelay = delay => new Promise(resolve => setTimeout(resolve, delay))\n\napp.post('/post', (req, res) => {\n  const postProgressPromise = async function() {\n    // The delay simulates time taken for a task to complete\n    await PromiseDelay(1000)\n    client.event.emit(`progress:${req.body.id}`, {percentage:15, message: 'Posting...'})\n    resolve({done: true})\n  }\n\n  const receiveProgressPromise = async function() {\n    await PromiseDelay(1000)\n    client.event.emit(`progress:${req.body.id}`, {percentage:30, message: 'Receiving...'})\n    resolve({done: true})\n  }\n\n  const processProgressPromise = await function() {\n    await PromiseDelay(1000)\n    client.event.emit(`progress:${req.body.id}`, {percentage:45, message: 'Processing...'})\n    resolve({done: true})\n  }\n\n  const completeProgressPromise = function() {\n    await PromiseDelay(1000)\n    client.event.emit(`progress:${req.body.id}`, {percentage:60, message: 'Completing...'})\n    resolve({done: true})\n  }\n\n  const endProgressPromise = async function() {\n    await PromiseDelay(1000)\n    client.event.emit(`progress:${req.body.id}`, {percentage:100})\n    resolve({done: true})\n  }\n\n  postProgressPromise()\n    .then(receiveProgressPromise)\n    .then(processProgressPromise)\n    .then(completeProgressPromise)\n    .then(endProgressPromise)\n    .then(() => res.json({status: 'Completed'}))\n})\n")),(0,o.kt)("p",null,"After a second or two (which is a simulating a real live long request), we emit a deepstream event. These events are sent with payload containing the percentage estimate and the feedback message for the client."))}m.isMDXComponent=!0}}]);